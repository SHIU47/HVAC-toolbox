<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCW 系統估算工具 PRO v6.3 </title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');

        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* 動畫效果 */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes highlightPulse { 
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); border-color: #3b82f6; } 
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); border-color: #3b82f6; } 
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } 
        }
        
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
        .card-highlight { animation: highlightPulse 1.5s ease-out infinite; }

        /* P&ID Flow Animation */
        @keyframes dash {
            to { stroke-dashoffset: -20; }
        }
        .flow-line {
            stroke-dasharray: 5;
            animation: dash 0.5s linear infinite;
        }
        .flow-line-slow {
            stroke-dasharray: 5;
            animation: dash 1s linear infinite;
        }

        /* 滾動條美化 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* 列印優化 */
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .page-break { page-break-before: always; }
            .print-shadow-none { box-shadow: none !important; border: 1px solid #e2e8f0; }
            .rfq-paper { box-shadow: none !important; border: none !important; padding: 0 !important; width: 100% !important; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 selection:bg-blue-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        // --- Constants ---
        const UNLOCK_PASSWORD = "900407";
        const STORAGE_KEY = 'pcw_estimator_v6_3_data';
        const GRAVITY = 9.81;

        // Fluid Properties Library
        const FLUIDS = {
            'water': { name: '純水 (Water)', rho: 1000, cp: 4.186 },
            'eg30': { name: '乙二醇 30% (EG 30%)', rho: 1045, cp: 3.600 },
            'eg50': { name: '乙二醇 50% (EG 50%)', rho: 1070, cp: 3.350 },
            'pg30': { name: '丙二醇 30% (PG 30%)', rho: 1030, cp: 3.800 },
        };

        // --- Icon Component (Lucide style) ---
        const Icon = ({ name, size = 18, className = "", ...props }) => {
            const paths = {
                Calculator: <><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>,
                Layout: <><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></>,
                Settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>,
                Lock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
                Unlock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></>,
                Printer: <><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></>,
                HelpCircle: <><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></>,
                Plus: <path d="M5 12h14M12 5v14"/>,
                Trash2: <><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>,
                ChevronDown: <path d="m6 9 6 6 6-6"/>,
                Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>,
                Shield: <><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></>,
                Droplets: <><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></>,
                Wind: <><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></>,
                Filter: <><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></>,
                Box: <><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></>,
                CheckCircle2: <><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>,
                FileText: <><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>,
                Download: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>,
                Copy: <><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></>,
                Zap: <><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></>,
                Table: <><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="3" x2="21" y1="15" y2="15"/><line x1="12" x2="12" y1="3" y2="21"/></>,
                Book: <><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>,
                AlertTriangle: <><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>,
                Snowflake: <><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></>,
                Thermometer: <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/>,
                AlertCircle: <><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>,
                Info: <><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>,
                MousePointerClick: <><path d="M14 4.1 12 6"/><path d="m5.1 8-2.9-.8"/><path d="m6 12-1.9 2"/><path d="M7.2 2.2 8 5.1"/><path d="M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z"/></>
            };

            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                    {paths[name] || <circle cx="12" cy="12" r="10"/>}
                </svg>
            );
        };

        // --- P&ID Visualizer Component (Interactive) ---
        const PIDSchematic = ({ systemType, hasZones, onNavigate }) => {
            const isClosed = systemType === 'closed';
            
            // SVG Paths
            const tankColor = isClosed ? "#6366f1" : "#0ea5e9";
            const tankLabel = isClosed ? "EXP. TANK" : "RECEIVER TANK";
            
            // Layout Coordinates
            const tankX = isClosed ? 100 : 60, tankY = isClosed ? 100 : 70;
            const pumpX = 180, pumpY = 160;
            const filterX = 300, filterY = 160;
            const pheX = 440, pheY = 160;
            const loadX = 580, loadY = 160;     

            // Interactive group wrapper
            const InteractiveGroup = ({ type, x, y, children, label }) => (
                <g 
                    transform={`translate(${x}, ${y})`} 
                    onClick={() => onNavigate(type)} 
                    className="cursor-pointer group hover:opacity-100 transition-all duration-300"
                    style={{opacity: 0.9}}
                >
                    {/* Hover Glow Effect */}
                    <circle cx="0" cy="0" r="45" fill="white" className="opacity-0 group-hover:opacity-10 transition-opacity" />
                    {children}
                    {/* Click Hint */}
                    <g className="opacity-0 group-hover:opacity-100 transition-opacity" transform="translate(25, -25)">
                        <circle cx="0" cy="0" r="8" fill="#3b82f6" />
                        <path d="M -3 -3 L 3 3 M 3 -3 L -3 3" stroke="white" strokeWidth="1.5" />
                    </g>
                </g>
            );

            return (
                <div className="w-full bg-slate-900 rounded-lg p-4 overflow-hidden relative shadow-inner border border-slate-700 select-none">
                    <div className="absolute top-2 left-3 text-xs font-mono text-slate-400 flex items-center gap-2">
                        <span>DYNAMIC P&ID (INTERACTIVE)</span>
                        <span className="bg-slate-700 text-slate-300 px-1.5 py-0.5 rounded text-[9px] flex items-center gap-1"><Icon name="MousePointerClick" size={10}/> Click components to edit</span>
                    </div>
                    <div className="absolute top-2 right-3 flex gap-3">
                        <div className="flex items-center gap-1 text-[10px] text-cyan-400 font-mono"><span className="w-2 h-2 rounded-full bg-cyan-400"></span> CHW</div>
                        <div className="flex items-center gap-1 text-[10px] text-teal-400 font-mono"><span className="w-2 h-2 rounded-full bg-teal-400"></span> CWS</div>
                    </div>
                    
                    <svg viewBox="0 0 680 250" className="w-full h-48 md:h-64">
                        <defs>
                            <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L6,3 z" fill="#94a3b8" />
                            </marker>
                        </defs>

                        {/* --- PIPES --- */}
                        {isClosed ? (
                            <path d={`M ${tankX} ${tankY+30} L ${tankX} ${220}`} stroke="#94a3b8" strokeWidth="2" strokeDasharray="4 4" />
                        ) : (
                            <path d={`M ${tankX+40} ${tankY+50} L ${tankX+40} ${pumpY} L ${pumpX-20} ${pumpY}`} stroke="#ef4444" strokeWidth="3" className="flow-line-slow" />
                        )}
                        <path d={`M ${pumpX+20} ${pumpY} L ${filterX-20} ${filterY}`} stroke="#3b82f6" strokeWidth="3" className="flow-line" />
                        <path d={`M ${filterX+20} ${filterY} L ${pheX-40} ${pheY}`} stroke="#3b82f6" strokeWidth="3" className="flow-line" />
                        <path d={`M ${pheX+40} ${pheY} L ${loadX-30} ${loadY}`} stroke="#3b82f6" strokeWidth="3" className="flow-line" />
                        {isClosed ? (
                            <path d={`M ${loadX+30} ${loadY} L ${loadX+50} ${loadY} L ${loadX+50} ${220} L ${50} ${220} L ${50} ${pumpY} L ${pumpX-20} ${pumpY}`} stroke="#ef4444" strokeWidth="3" fill="none" className="flow-line-slow" />
                        ) : (
                            <path d={`M ${loadX+30} ${loadY} L ${loadX+50} ${loadY} L ${loadX+50} ${220} L ${tankX} ${220} L ${tankX} ${tankY+50}`} stroke="#ef4444" strokeWidth="3" fill="none" className="flow-line-slow" />
                        )}

                        {/* --- COMPONENTS --- */}
                        
                        <InteractiveGroup type="pump" x={pumpX} y={pumpY} label="PUMP">
                            <circle cx="0" cy="0" r="20" fill="#10b981" stroke="white" strokeWidth="2"/>
                            <path d="M -10 10 L 15 0 L -10 -10 Z" fill="white"/>
                            <text x="0" y="35" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold">PUMP</text>
                        </InteractiveGroup>

                        <InteractiveGroup type="filter" x={filterX} y={filterY} label="FILTER">
                            <path d="M -15 -20 L 15 -20 L 0 20 Z" fill="#f59e0b" stroke="white" strokeWidth="2"/>
                            <line x1="0" y1="-20" x2="0" y2="20" stroke="white" strokeWidth="1"/>
                            <text x="0" y="35" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold">FILTER</text>
                        </InteractiveGroup>

                        <InteractiveGroup type="phe" x={pheX} y={pheY} label="PHE">
                            <rect x="-40" y="-35" width="80" height="70" rx="4" fill="#1e293b" stroke="#3b82f6" strokeWidth="2" />
                            <path d="M -20 -35 L -20 35 M 0 -35 L 0 35 M 20 -35 L 20 35" stroke="#334155" strokeWidth="1" />
                            <text x="0" y="50" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold">PHE (Dual)</text>
                            <path d="M -20 -35 L -20 -60" stroke="#22d3ee" strokeWidth="2" strokeDasharray="3 3" />
                            <text x="-20" y="-65" textAnchor="middle" fill="#22d3ee" fontSize="8" fontWeight="bold">CHW</text>
                            <path d="M 20 -35 L 20 -60" stroke="#2dd4bf" strokeWidth="2" strokeDasharray="3 3" />
                            <text x="20" y="-65" textAnchor="middle" fill="#2dd4bf" fontSize="8" fontWeight="bold">CWS</text>
                        </InteractiveGroup>

                        <g transform={`translate(${loadX}, ${loadY})`}>
                            <rect x="-30" y="-25" width="60" height="50" fill="#64748b" stroke="white" strokeWidth="2"/>
                            <text x="0" y="5" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold">FAB LOAD</text>
                            <text x="0" y="40" textAnchor="middle" fill="#cbd5e1" fontSize="8">{hasZones ? "ACTIVE" : "NO LOAD"}</text>
                        </g>

                        <InteractiveGroup type="tank" x={tankX} y={tankY} label="TANK">
                            {isClosed ? (
                                <g>
                                    <ellipse cx="0" cy="0" rx="25" ry="30" fill={tankColor} stroke="white" strokeWidth="2"/>
                                    <line x1="-25" y1="0" x2="25" y2="0" stroke="white" strokeWidth="1"/>
                                </g>
                            ) : (
                                <g>
                                    <path d="M -40 -30 L 40 -30 L 40 30 C 40 45 -40 45 -40 30 Z" fill="none" stroke="white" strokeWidth="2"/>
                                    <path d="M -35 30 C -35 40 35 40 35 30" fill="none" stroke="#0ea5e9" strokeWidth="2"/>
                                    <rect x="-35" y="10" width="70" height="25" fill="#0ea5e9" opacity="0.5"/>
                                </g>
                            )}
                            <text x={isClosed ? 0 : 0} y={isClosed ? -40 : -45} textAnchor="middle" fill={tankColor} fontSize="10" fontWeight="bold">{tankLabel}</text>
                        </InteractiveGroup>

                    </svg>
                </div>
            );
        };

        // --- Shared Components ---
        const Modal = ({ isOpen, onClose, title, children, wide=false }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm animate-fade-in p-4">
                    <div className={`bg-white rounded-xl shadow-2xl w-full border border-slate-200 overflow-hidden flex flex-col max-h-[90vh] ${wide ? 'max-w-4xl' : 'max-w-lg'}`}>
                        <div className="flex justify-between items-center p-4 border-b border-slate-100 bg-slate-50 shrink-0">
                            <h3 className="font-bold text-slate-800 flex items-center gap-2">{title}</h3>
                            <button onClick={onClose} className="p-1 text-slate-400 hover:text-slate-600 rounded-full hover:bg-slate-200 transition">✕</button>
                        </div>
                        <div className="p-6 overflow-y-auto bg-slate-50">{children}</div>
                    </div>
                </div>
            );
        };

        const Card = React.forwardRef(({ children, className = "", highlighted }, ref) => (
            <div ref={ref} className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden print:shadow-none print:border-slate-300 transition-all duration-500 ${className} ${highlighted ? 'card-highlight ring-2 ring-blue-500' : ''}`}>
                {children}
            </div>
        ));

        const SectionHeader = ({ icon, title, colorClass, subtitle }) => (
            <div className={`p-4 border-b flex justify-between items-center ${colorClass}`}>
                <div className="flex items-center gap-2">
                    <Icon name={icon} className="opacity-80"/>
                    <h3 className="font-bold text-slate-800">{title}</h3>
                </div>
                {subtitle && <span className="text-[10px] opacity-70 font-mono hidden md:inline-block">{subtitle}</span>}
            </div>
        );

        const InputGroup = ({ label, children, unit, className="", tooltip, error }) => (
            <div className={`mb-4 ${className}`}>
                <div className="flex items-center gap-1 mb-1.5">
                    <label className="text-xs font-semibold text-slate-500 uppercase tracking-wide">{label}</label>
                    {tooltip && <div className="group relative">
                        <Icon name="Info" size={12} className="text-slate-400 cursor-help"/>
                        <div className="absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-48 p-2 bg-slate-800 text-white text-[10px] rounded shadow-lg pointer-events-none opacity-0 group-hover:opacity-100 transition z-50">
                            {tooltip}
                        </div>
                    </div>}
                </div>
                <div className="relative">
                    {children}
                    {unit && <span className="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400 font-medium pointer-events-none">{unit}</span>}
                </div>
                {error && <div className="text-[10px] text-red-500 mt-1 font-medium flex items-center gap-1"><Icon name="AlertCircle" size={10}/> {error}</div>}
            </div>
        );

        // --- Utils ---
        const getSuggestedDN = (flowM3h, velocityTarget = 2.0) => {
            if(flowM3h <= 0) return { dn: 0, vel: 0 };
            const flowM3s = flowM3h / 3600;
            const targetArea = flowM3s / velocityTarget;
            const targetDiaMM = Math.sqrt((4 * targetArea) / Math.PI) * 1000;
            const sizes = [15, 20, 25, 32, 40, 50, 65, 80, 100, 125, 150, 200, 250, 300, 350, 400, 500, 600];
            const chosenDN = sizes.find(s => s >= targetDiaMM) || sizes[sizes.length-1];
            const actualArea = (Math.PI * Math.pow(chosenDN/1000, 2)) / 4;
            const actualVel = flowM3s / actualArea;
            return { dn: chosenDN, vel: actualVel };
        };

        const getVaporPressure = (tempC) => 0.61078 * Math.exp((17.27 * tempC) / (tempC + 237.3));

        // --- Main App Component ---
        const PCWEstimator = () => {
            // --- State ---
            const [activeTab, setActiveTab] = useState('demand');
            
            // Feature State
            const [isLocked, setIsLocked] = useState(true);
            const [showUnlockModal, setShowUnlockModal] = useState(false);
            const [showRFQModal, setShowRFQModal] = useState(false);
            const [showHelpModal, setShowHelpModal] = useState(false);
            const [helpTab, setHelpTab] = useState('quick');
            const [passwordInput, setPasswordInput] = useState("");
            const [unlockError, setUnlockError] = useState(false);
            const [pendingAction, setPendingAction] = useState(null);
            
            // Interactive State
            const [highlightedCard, setHighlightedCard] = useState(null);
            const cardRefs = {
                phe: useRef(null),
                pump: useRef(null),
                filter: useRef(null),
                tank: useRef(null)
            };

            // Data State
            const defaultZones = [
                { id: '1', name: 'L1 - Main Fab (製程區)', flowRaw: 150, unit: 'm3h', deltaT: 5 },
                { id: '2', name: 'L2 - Sub Fab (輔助區)', flowRaw: 80, unit: 'm3h', deltaT: 5 },
                { id: '3', name: 'CUB - Utility (廠務區)', flowRaw: 20000, unit: 'Lh', deltaT: 4 }, 
            ];

            const defaultParams = {
                fluidType: 'water',
                safetyFactor: 1.1,
                chillerMargin: 1.15,
                globalDeltaT: 5,
                simultaneity: 1.0,
                supplyTemp: 20,
            };

            const defaultEquipParams = {
                systemType: 'closed',
                specQuality: 'Industrial',
                specStandard: 'ASME',
                specRedundancy: 'N+1',
                pheSecDeltaT: 7, pheApproach: 2, pheMaterial: 'SS316', pheThickness: '0.5', pheGasket: 'EPDM', phePressure: '10', pheSpare: 20,
                filterType: 'bag', filterMicron: 50, filterHousing: 'SS304', dpFilter: 50,
                pumpType: 'vertical', pumpMaterial: 'SUS304', pumpRPM: '3600', pumpVFD: 'Yes', pumpPowerSource: '380V/3Ø/60Hz', 
                motorEff: 'IE3', pumpEfficiency: 0.75, motorEfficiency: 0.90,
                staticHead: 2, suctionFrictionLoss: 0.5,
                dpPHE: 50, dpLoop: 250,
                tankStrategy: 'auto', tankMaterial: 'SS304', tankOrient: 'vertical', tankHoldupTime: 5, estSystemVol: 0,
            };

            const [zones, setZones] = useState(defaultZones);
            const [params, setParams] = useState(defaultParams);
            const [equipParams, setEquipParams] = useState(defaultEquipParams);
            const [isSettingsOpen, setIsSettingsOpen] = useState(true);

            // --- Persistence ---
            useEffect(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if(parsed.zones) setZones(parsed.zones);
                        if(parsed.params) setParams({...defaultParams, ...parsed.params});
                        if(parsed.equipParams) setEquipParams({...defaultEquipParams, ...parsed.equipParams});
                    } catch(e) { console.error("Load Error", e); }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({ zones, params, equipParams }));
            }, [zones, params, equipParams]);

            // --- Logic ---
            const fluidProp = FLUIDS[params.fluidType] || FLUIDS['water'];
            const heatFactor = (fluidProp.rho * fluidProp.cp) / 3600;
            const toM3h = (flow, unit) => unit === 'Lh' ? flow / 1000 : flow;
            const calculateZoneLoad = (flowM3h, dt) => heatFactor * flowM3h * dt;

            const systemKPI = useMemo(() => {
                let installedFlowM3h = 0;
                let installedLoadKW = 0;
                const detailedZones = zones.map(zone => {
                    const flowM3h = toM3h(zone.flowRaw, zone.unit);
                    const loadKW = calculateZoneLoad(flowM3h, zone.deltaT);
                    installedFlowM3h += flowM3h;
                    installedLoadKW += loadKW;
                    return { ...zone, flowM3h, loadKW };
                });
                const effectiveFlowM3h = installedFlowM3h * params.simultaneity;
                const effectiveLoadKW = installedLoadKW * params.simultaneity;
                const effectiveLoadRT = effectiveLoadKW / 3.517;
                const recChillerCapacityKW = effectiveLoadKW * params.chillerMargin;
                const recChillerCapacityRT = recChillerCapacityKW / 3.517;
                const recPumpFlowM3h = effectiveFlowM3h * params.safetyFactor;
                const designReturnTemp = params.supplyTemp + params.globalDeltaT;

                return { zones: detailedZones, installedFlowM3h, installedLoadKW, effectiveFlowM3h, effectiveLoadKW, effectiveLoadRT, recChillerCapacityKW, recChillerCapacityRT, recPumpFlowM3h, designReturnTemp };
            }, [zones, params, equipParams.systemType]);

            const equipKPI = useMemo(() => {
                const pheDutyKW = systemKPI.effectiveLoadKW;
                const pheSecFlowM3h = pheDutyKW > 0 ? pheDutyKW / (heatFactor * equipParams.pheSecDeltaT) : 0;
                const pheNozzle = getSuggestedDN(systemKPI.effectiveFlowM3h, 2.0);
                const pheSecNozzle = getSuggestedDN(pheSecFlowM3h, 2.0);
                const totalDP_kPa = equipParams.dpFilter + equipParams.dpPHE + equipParams.dpLoop;
                const pumpHeadM = totalDP_kPa / (GRAVITY * (fluidProp.rho / 1000));
                const pEff = equipParams.pumpEfficiency || 0.75;
                const mEff = equipParams.motorEfficiency || 0.90;
                const pumpEstShaftKW = (systemKPI.recPumpFlowM3h * pumpHeadM * (fluidProp.rho/1000) * GRAVITY) / (3600 * pEff * mEff); 
                const pumpSuction = getSuggestedDN(systemKPI.recPumpFlowM3h, 1.5);
                const pumpDischarge = getSuggestedDN(systemKPI.recPumpFlowM3h, 2.5);

                let npshA = 0, vaporPressureKpa = 0, npshStatus = "OK";
                if(equipParams.systemType === 'open') {
                    const patmM = 10.33; 
                    vaporPressureKpa = getVaporPressure(params.supplyTemp + 2); 
                    const vpHeadM = vaporPressureKpa / (GRAVITY * (fluidProp.rho/1000));
                    npshA = patmM + equipParams.staticHead - vpHeadM - equipParams.suctionFrictionLoss;
                    if(npshA < 3) npshStatus = "Critical"; 
                    if(npshA < 1) npshStatus = "Fail";
                }

                let filterConfig = "", filterModel = "";
                const filterDN = pumpDischarge.dn;
                if (equipParams.filterType === 'bag') {
                    const bagsNeeded = Math.ceil(systemKPI.recPumpFlowM3h / 30);
                    filterConfig = `${bagsNeeded} 濾袋 (Bag)`;
                    filterModel = `BF-${bagsNeeded} (Size 2)`;
                } else {
                    const roundsNeeded = Math.ceil(systemKPI.recPumpFlowM3h / 4);
                    filterConfig = `${roundsNeeded} 支濾心 (Rounds)`;
                    filterModel = `CF-${roundsNeeded} (40")`;
                }

                let reqTankVol = 0, tankDesc = "", estSystemWaterVol = 0;
                if (equipParams.systemType === 'closed') {
                    const volFactor = 0.015; 
                    estSystemWaterVol = equipParams.estSystemVol > 0 ? equipParams.estSystemVol : (systemKPI.installedLoadKW * volFactor);
                    reqTankVol = estSystemWaterVol * 0.05; 
                    tankDesc = "膨脹水箱 (Expansion Tank)";
                } else {
                    reqTankVol = (systemKPI.recPumpFlowM3h / 60) * equipParams.tankHoldupTime;
                    tankDesc = "Receiver / Buffer Tank";
                }

                return { 
                    pheDutyKW, pheSecFlowM3h, pheNozzle, pheSecNozzle,
                    totalDP_kPa, pumpHeadM, pumpSuction, pumpDischarge, pumpEstShaftKW,
                    npshA, npshStatus, vaporPressureKpa,
                    filterConfig, filterModel, filterDN,
                    reqTankVol, tankDesc, estSystemWaterVol 
                };
            }, [systemKPI, equipParams, params, fluidProp]);

            // --- Handlers ---
            const addZone = () => setZones([...zones, { id: Math.random().toString(36).substr(2, 9), name: '新區域 (New Zone)', flowRaw: 0, unit: 'm3h', deltaT: params.globalDeltaT }]);
            const removeZone = (id) => setZones(zones.filter(z => z.id !== id));
            const updateZone = (id, f, v) => setZones(zones.map(z => z.id === id ? { ...z, [f]: v } : z));

            // Interactive Navigation Logic
            const handleNavigate = (section) => {
                setActiveTab('equipment');
                // Allow DOM to update if switching tabs
                setTimeout(() => {
                    const ref = cardRefs[section];
                    if (ref && ref.current) {
                        ref.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setHighlightedCard(section);
                        setTimeout(() => setHighlightedCard(null), 2000); // Remove highlight after 2s
                    }
                }, 100);
            };

            // --- RFQ & Excel ---
            const generateRFQData = () => {
                return {
                    date: new Date().toISOString().split('T')[0],
                    general: {
                        fluid: fluidProp.name,
                        quality: equipParams.specQuality,
                        standard: equipParams.specStandard,
                        redundancy: equipParams.specRedundancy
                    },
                    phe: {
                        duty: equipKPI.pheDutyKW.toFixed(0),
                        flowPri: systemKPI.effectiveFlowM3h.toFixed(1),
                        approach: equipParams.pheApproach,
                        material: equipParams.pheMaterial,
                        pressure: equipParams.phePressure
                    },
                    pump: {
                        type: equipParams.pumpType,
                        flow: systemKPI.recPumpFlowM3h.toFixed(1),
                        head: equipKPI.pumpHeadM.toFixed(1),
                        power: equipKPI.pumpEstShaftKW.toFixed(2),
                        npsh: equipParams.systemType === 'open' ? equipKPI.npshA.toFixed(1) : 'N/A'
                    },
                    filter: {
                        type: equipParams.filterType,
                        micron: equipParams.filterMicron,
                        model: equipKPI.filterModel
                    },
                    tank: {
                        type: equipKPI.tankDesc,
                        vol: equipKPI.reqTankVol.toFixed(2),
                        material: equipParams.tankMaterial
                    }
                };
            };

            const handleExportExcel = () => {
                const wb = XLSX.utils.book_new();
                const d = generateRFQData();
                const wsData = [
                    ["PCW 系統設備詢價單"],
                    ["日期", d.date],
                    [],
                    ["1. 總體設計", "", ""],
                    ["流體", d.general.fluid], ["標準", d.general.standard], ["備援", d.general.redundancy],
                    [],
                    ["2. 板式熱交換器 (PHE)", "", ""],
                    ["熱交換量 (kW)", d.phe.duty], ["流量 (m3/h)", d.phe.flowPri], ["材質", d.phe.material],
                    [],
                    ["3. 循環泵浦", "", ""],
                    ["形式", d.pump.type], ["流量", d.pump.flow], ["揚程", d.pump.head],
                    [],
                    ["4. 過濾器", "", ""],
                    ["型號", d.filter.model], ["精度", d.filter.micron],
                    [],
                    ["5. 水箱", "", ""],
                    ["類型", d.tank.type], ["體積", d.tank.vol]
                ];
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                XLSX.utils.book_append_sheet(wb, ws, "PCW RFQ");
                XLSX.writeFile(wb, `PCW_RFQ_${d.date}.xlsx`);
            };

            const handleProtectedAction = (action) => {
                if (isLocked) {
                    setPendingAction(() => action);
                    setShowUnlockModal(true);
                } else {
                    action();
                }
            };

            const attemptUnlock = () => {
                if (passwordInput === UNLOCK_PASSWORD) {
                    setIsLocked(false);
                    setShowUnlockModal(false);
                    setPasswordInput("");
                    setUnlockError(false);
                    if (pendingAction) {
                        pendingAction();
                        setPendingAction(null);
                    }
                } else {
                    setUnlockError(true);
                }
            };

            return (
                <div className="min-h-screen pb-12 print:bg-white text-sm">
                    {/* Header */}
                    <div className="bg-slate-900 text-white shadow-xl border-b border-slate-800 sticky top-0 z-40 print:hidden">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="bg-blue-600 p-2 rounded-lg shadow-lg shadow-blue-500/20">
                                    <Icon name="Calculator" className="text-white" size={20}/>
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold tracking-tight leading-tight">PCW 系統估算工具 <span className="text-[10px] bg-emerald-500 text-white px-2 py-0.5 rounded-full ml-1">v6.3</span></h1>
                                    <p className="text-[10px] text-slate-400 font-medium">Design & UX Edition</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="bg-slate-800/50 p-1 rounded-lg border border-slate-700/50 flex gap-1">
                                    <button onClick={() => setActiveTab('demand')} className={`px-4 py-1.5 rounded-md text-xs font-bold transition-all flex items-center gap-2 ${activeTab === 'demand' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:text-white'}`}><Icon name="Layout" size={14}/> 需求與負荷</button>
                                    <button onClick={() => setActiveTab('equipment')} className={`px-4 py-1.5 rounded-md text-xs font-bold transition-all flex items-center gap-2 ${activeTab === 'equipment' ? 'bg-indigo-600 text-white' : 'text-slate-400 hover:text-white'}`}><Icon name="Settings" size={14}/> 設備選型</button>
                                </div>
                                <div className="h-6 w-px bg-slate-700 mx-1"></div>
                                <button onClick={() => setShowRFQModal(true)} className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-1.5 rounded-md text-xs font-bold transition shadow-lg shadow-emerald-500/20"><Icon name="FileText" size={14}/> 詢價單</button>
                                <button onClick={() => isLocked ? setShowUnlockModal(true) : setIsLocked(true)} className={`p-2 rounded-full transition ${isLocked ? 'text-amber-500' : 'text-emerald-500'}`} title={isLocked ? "已鎖定" : "已解鎖"}><Icon name={isLocked ? "Lock" : "Unlock"} size={18}/></button>
                                <button onClick={() => setShowHelpModal(true)} className="p-2 text-slate-400 hover:text-white transition" title="說明"><Icon name="Book" size={18}/></button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto p-4 md:p-6 print:p-0 print:w-full">
                        {/* Tab 1: Demand */}
                        {activeTab === 'demand' && (
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 animate-fade-in print:block">
                                <div className="lg:col-span-8 space-y-6">
                                    <Card>
                                        <button onClick={() => setIsSettingsOpen(!isSettingsOpen)} className="w-full flex justify-between items-center p-4 bg-slate-50 border-b border-slate-100">
                                            <span className="font-bold text-slate-700 flex items-center gap-2 text-sm"><Icon name="Settings" size={16}/> 設計基準 (Design Basis)</span>
                                            <Icon name="ChevronDown" size={16} className={`transition text-slate-400 ${isSettingsOpen ? 'rotate-180':''}`}/>
                                        </button>
                                        {isSettingsOpen && (
                                            <div className="p-5 grid grid-cols-1 sm:grid-cols-3 gap-6 bg-white">
                                                <div className="space-y-4">
                                                    <h4 className="text-xs font-bold text-blue-600 uppercase border-b border-blue-100 pb-1">負荷參數</h4>
                                                    <InputGroup label="流體性質 (Fluid)">
                                                        <select value={params.fluidType} onChange={(e)=>setParams({...params, fluidType: e.target.value})} className="w-full border p-2 rounded text-sm outline-none focus:border-blue-500">
                                                            {Object.entries(FLUIDS).map(([k, v]) => <option key={k} value={k}>{v.name}</option>)}
                                                        </select>
                                                    </InputGroup>
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <InputGroup label="同時使用"><input type="number" step="0.05" value={params.simultaneity} onChange={(e)=>setParams({...params, simultaneity: parseFloat(e.target.value)||1})} className="w-full border p-2 rounded text-sm outline-none focus:border-blue-500"/></InputGroup>
                                                        <InputGroup label="安全係數"><input type="number" step="0.05" value={params.safetyFactor} onChange={(e)=>setParams({...params, safetyFactor: parseFloat(e.target.value)||1.1})} className="w-full border p-2 rounded text-sm outline-none focus:border-blue-500"/></InputGroup>
                                                    </div>
                                                </div>
                                                <div className="space-y-4">
                                                    <h4 className="text-xs font-bold text-emerald-600 uppercase border-b border-emerald-100 pb-1">溫度設定</h4>
                                                    <InputGroup label="供水溫度" unit="°C"><input type="number" value={params.supplyTemp} onChange={(e)=>setParams({...params, supplyTemp: parseFloat(e.target.value)||20})} className="w-full border p-2 rounded text-sm outline-none focus:border-blue-500"/></InputGroup>
                                                    <InputGroup label="設計溫差 ΔT" unit="°C"><input type="number" step="0.5" value={params.globalDeltaT} onChange={(e)=>setParams({...params, globalDeltaT: parseFloat(e.target.value)||5})} className="w-full border p-2 rounded text-sm outline-none focus:border-blue-500"/></InputGroup>
                                                </div>
                                                <div className="space-y-4">
                                                    <h4 className="text-xs font-bold text-slate-400 uppercase border-b border-slate-100 pb-1">系統預覽</h4>
                                                    <div className="text-xs text-slate-500 space-y-2 pt-2">
                                                        <div className="flex justify-between"><span>回水溫度:</span> <b>{systemKPI.designReturnTemp}°C</b></div>
                                                        <div className="flex justify-between"><span>流體密度:</span> <b>{fluidProp.rho} kg/m³</b></div>
                                                        <div className="flex justify-between"><span>比熱 (Cp):</span> <b>{fluidProp.cp} kJ/kg.K</b></div>
                                                        <div className="flex justify-between"><span>換熱因子:</span> <b>{heatFactor.toFixed(3)}</b></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </Card>

                                    <Card className="min-h-[400px]">
                                        <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                            <h3 className="font-bold text-slate-800 flex items-center gap-2"><Icon name="FileText" className="text-blue-500"/> 區域負載列表</h3>
                                            <button onClick={addZone} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 flex items-center gap-1"><Icon name="Plus" size={14}/> 新增</button>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-left border-collapse">
                                                <thead className="bg-slate-50 text-slate-500 text-xs uppercase font-semibold">
                                                    <tr>
                                                        <th className="px-4 py-3 w-10">#</th>
                                                        <th className="px-4 py-3">名稱</th>
                                                        <th className="px-4 py-3 w-28">流量</th>
                                                        <th className="px-4 py-3 w-20">單位</th>
                                                        <th className="px-4 py-3 w-20">ΔT</th>
                                                        <th className="px-4 py-3 text-right">kW</th>
                                                        <th className="px-4 py-3 w-8"></th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {systemKPI.zones.map((z, idx) => (
                                                        <tr key={z.id} className="hover:bg-blue-50/30">
                                                            <td className="px-4 py-2 text-center text-slate-400">{idx+1}</td>
                                                            <td className="px-4 py-2"><input value={z.name} onChange={(e)=>updateZone(z.id, 'name', e.target.value)} className="w-full bg-transparent outline-none text-slate-700 placeholder:text-slate-300"/></td>
                                                            <td className="px-4 py-2"><input type="number" value={z.flowRaw} onChange={(e)=>updateZone(z.id, 'flowRaw', parseFloat(e.target.value)||0)} className="w-full border rounded px-2 py-1 text-sm outline-none text-slate-600 font-mono"/></td>
                                                            <td className="px-4 py-2"><select value={z.unit} onChange={(e)=>updateZone(z.id, 'unit', e.target.value)} className="bg-transparent text-xs font-bold text-slate-500 outline-none"><option value="m3h">m³/h</option><option value="Lh">L/h</option></select></td>
                                                            <td className="px-4 py-2"><input type="number" value={z.deltaT} onChange={(e)=>updateZone(z.id, 'deltaT', parseFloat(e.target.value)||0)} className="w-full text-center border-b border-dashed border-slate-300 outline-none bg-transparent font-mono text-sm"/></td>
                                                            <td className="px-4 py-2 text-right font-mono font-bold text-blue-600">{z.loadKW.toFixed(1)}</td>
                                                            <td className="px-4 py-2 text-center"><button onClick={()=>removeZone(z.id)} className="text-slate-300 hover:text-red-500"><Icon name="Trash2" size={14}/></button></td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </Card>
                                </div>
                                <div className="lg:col-span-4 space-y-6">
                                    {/* Chiller Card with Load Bar */}
                                    <div className="bg-gradient-to-br from-blue-900 to-slate-900 text-white rounded-xl p-6 shadow-xl relative overflow-hidden ring-1 ring-white/10 print:border print:border-slate-300 print:text-black print:shadow-none print:bg-white">
                                        <div className="absolute -right-6 -top-6 text-slate-800"><Icon name="Snowflake" size={150} className="opacity-20"/></div>
                                        <h3 className="text-sm font-bold text-blue-300 uppercase tracking-widest mb-4 flex items-center gap-2">
                                            <Icon name="Thermometer" size={16}/> 系統熱負荷 (System Load)
                                        </h3>
                                        <div className="mb-4">
                                            <div className="text-4xl font-bold tracking-tight text-white mb-1 print:text-black">{systemKPI.effectiveLoadKW.toLocaleString(undefined, {maximumFractionDigits: 0})} <span className="text-lg font-medium text-slate-400">kW</span></div>
                                            <div className="font-mono text-blue-200 text-sm print:text-slate-600">≈ {systemKPI.effectiveLoadRT.toFixed(1)} RT</div>
                                        </div>
                                        
                                        {/* Load Capacity Bar */}
                                        <div className="mb-4">
                                            <div className="flex justify-between text-[10px] text-slate-400 mb-1">
                                                <span>Capacity Usage</span>
                                                <span>{((systemKPI.effectiveLoadKW / (systemKPI.recChillerCapacityKW || 1)) * 100).toFixed(0)}% of Installed</span>
                                            </div>
                                            <div className="w-full h-1.5 bg-slate-700 rounded-full overflow-hidden">
                                                <div className="h-full bg-blue-400 rounded-full transition-all duration-500" style={{width: `${Math.min(((systemKPI.effectiveLoadKW / systemKPI.recChillerCapacityKW)*100), 100)}%`}}></div>
                                            </div>
                                        </div>

                                        <div className="pt-4 border-t border-white/10 print:border-slate-200">
                                            <div className="flex justify-between items-end">
                                                <span className="text-sm text-slate-400 print:text-slate-600">建議冰機容量 (Rec.)</span>
                                                <span className="font-mono text-xl font-bold text-blue-300 print:text-black">{systemKPI.recChillerCapacityRT.toFixed(0)} <span className="text-xs font-normal text-slate-500">RT</span></span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Pump Card */}
                                    <div className="bg-gradient-to-br from-emerald-900 to-slate-900 text-white rounded-xl p-6 shadow-xl relative overflow-hidden ring-1 ring-white/10 print:border print:border-slate-300 print:text-black print:shadow-none print:bg-white">
                                        <div className="absolute -right-6 -top-6 text-slate-800"><Icon name="Wind" size={150} className="opacity-20"/></div>
                                        <h3 className="text-sm font-bold text-emerald-300 uppercase tracking-widest mb-4 flex items-center gap-2">
                                            <Icon name="Activity" size={16}/> 循環流量 (Circulation Flow)
                                        </h3>
                                        <div className="mb-4">
                                            <div className="text-4xl font-bold tracking-tight text-white mb-1 print:text-black">{systemKPI.recPumpFlowM3h.toFixed(1)} <span className="text-lg font-medium text-slate-400">m³/h</span></div>
                                            <div className="font-mono text-emerald-200 text-sm print:text-slate-600">Design Flow</div>
                                        </div>
                                        <div className="pt-4 border-t border-white/10 print:border-slate-200">
                                            <div className="flex justify-between items-end">
                                                <span className="text-sm text-slate-400 print:text-slate-600">總安裝流量 (Installed)</span>
                                                <span className="font-mono text-xl font-bold text-emerald-300 print:text-black">{systemKPI.installedFlowM3h.toFixed(1)} <span className="text-xs font-normal text-slate-500">m³/h</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Tab 2: Equipment (RFQ Ready) */}
                        {activeTab === 'equipment' && (
                            <div className="space-y-6 animate-slide-in">
                                
                                {/* New: Interactive P&ID Visualizer */}
                                <PIDSchematic systemType={equipParams.systemType} hasZones={zones.length > 0} onNavigate={handleNavigate} />

                                {/* System Type Selector */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div onClick={() => setEquipParams({...equipParams, systemType: 'closed'})} className={`cursor-pointer rounded-xl border-2 p-5 transition-all relative ${equipParams.systemType === 'closed' ? 'border-indigo-600 bg-indigo-50/40' : 'border-slate-200 bg-white hover:border-slate-300'}`}>
                                        <div className="flex justify-between items-start mb-2"><div className={`p-2 rounded-lg ${equipParams.systemType === 'closed' ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-400'}`}><Icon name="Shield" size={20}/></div>{equipParams.systemType === 'closed' && <Icon name="CheckCircle2" className="text-indigo-600" size={20}/>}</div>
                                        <h3 className={`text-base font-bold mb-1 ${equipParams.systemType === 'closed' ? 'text-indigo-900' : 'text-slate-700'}`}>密閉式系統 (Closed)</h3>
                                        <p className="text-xs text-slate-500">使用膨脹水箱，隔絕大氣。適合高潔淨需求。</p>
                                    </div>
                                    <div onClick={() => setEquipParams({...equipParams, systemType: 'open'})} className={`cursor-pointer rounded-xl border-2 p-5 transition-all relative ${equipParams.systemType === 'open' ? 'border-sky-500 bg-sky-50/40' : 'border-slate-200 bg-white hover:border-slate-300'}`}>
                                        <div className="flex justify-between items-start mb-2"><div className={`p-2 rounded-lg ${equipParams.systemType === 'open' ? 'bg-sky-500 text-white' : 'bg-slate-100 text-slate-400'}`}><Icon name="Droplets" size={20}/></div>{equipParams.systemType === 'open' && <Icon name="CheckCircle2" className="text-sky-500" size={20}/>}</div>
                                        <h3 className={`text-base font-bold mb-1 ${equipParams.systemType === 'open' ? 'text-sky-900' : 'text-slate-700'}`}>開放式系統 (Receiver Tank)</h3>
                                        <p className="text-xs text-slate-500">回水進入儲槽，泵浦由儲槽吸水。</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                                    {/* Pump Card (Ref for navigation) */}
                                    <Card ref={cardRefs.pump} highlighted={highlightedCard === 'pump'} className="flex flex-col border-t-4 border-t-emerald-500">
                                        <SectionHeader icon="Wind" title="泵浦 (Pump)" colorClass="bg-emerald-50/50 border-emerald-100 text-emerald-900" subtitle={`H: ${equipKPI.pumpHeadM.toFixed(1)} m`}/>
                                        <div className="p-4 space-y-4 flex-1 text-sm">
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label="總壓損" unit="kPa" tooltip="PHE壓損 + 迴路壓損 + 過濾器壓損"><input type="number" value={equipKPI.totalDP_kPa} disabled className="w-full border-b border-slate-200 bg-slate-50 text-slate-500 pb-1 font-mono"/></InputGroup>
                                                <InputGroup label="轉速 (RPM)"><select value={equipParams.pumpRPM} onChange={(e)=>setEquipParams({...equipParams, pumpRPM: e.target.value})} className="w-full bg-transparent border-b border-slate-300 outline-none pb-1"><option value="3600">3600</option><option value="1800">1800</option></select></InputGroup>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label="迴路壓損" unit="kPa"><input type="number" value={equipParams.dpLoop} onChange={(e)=>setEquipParams({...equipParams, dpLoop: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                                <InputGroup label="PHE壓損" unit="kPa"><input type="number" value={equipParams.dpPHE} onChange={(e)=>setEquipParams({...equipParams, dpPHE: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                            </div>

                                            {equipParams.systemType === 'open' && (
                                                <div className={`p-2 rounded border text-xs ${equipKPI.npshStatus !== 'OK' ? 'bg-red-50 border-red-200 text-red-800' : 'bg-yellow-50 border-yellow-100 text-yellow-800'}`}>
                                                    <div className="font-bold mb-2 flex items-center gap-1"><Icon name="AlertCircle" size={12}/> NPSH Check</div>
                                                    <div className="grid grid-cols-2 gap-2 mb-2">
                                                        <div><span className="block text-[10px] text-slate-500">靜壓頭 (Hz)</span><input type="number" step="0.5" value={equipParams.staticHead} onChange={(e)=>setEquipParams({...equipParams, staticHead: parseFloat(e.target.value)})} className="w-full border rounded px-1 py-0.5 bg-white"/></div>
                                                        <div><span className="block text-[10px] text-slate-500">吸入損失 (Hf)</span><input type="number" step="0.1" value={equipParams.suctionFrictionLoss} onChange={(e)=>setEquipParams({...equipParams, suctionFrictionLoss: parseFloat(e.target.value)})} className="w-full border rounded px-1 py-0.5 bg-white"/></div>
                                                    </div>
                                                    <div className="flex justify-between items-center border-t border-slate-200/20 pt-1">
                                                        <span className="opacity-80">NPSHa:</span>
                                                        <span className="font-mono font-bold">{equipKPI.npshA.toFixed(2)}m ({equipKPI.npshStatus})</span>
                                                    </div>
                                                </div>
                                            )}

                                            <div className="bg-emerald-50 -mx-4 -mb-4 p-4 border-t border-emerald-100 mt-auto">
                                                <div className="flex justify-between mb-1"><span className="text-xs text-emerald-800 font-semibold">預估軸功</span><span className="font-mono font-bold text-emerald-600">{equipKPI.pumpEstShaftKW.toFixed(2)} kW</span></div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-xs text-emerald-800 font-semibold">建議口徑</span>
                                                    <span className="font-mono text-xs">{equipKPI.pumpSuction.dn}x{equipKPI.pumpDischarge.dn}A</span>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>

                                    {/* Filter Card */}
                                    <Card ref={cardRefs.filter} highlighted={highlightedCard === 'filter'} className="flex flex-col border-t-4 border-t-amber-500">
                                        <SectionHeader icon="Filter" title="過濾 (Filter)" colorClass="bg-amber-50/50 border-amber-100 text-amber-900"/>
                                        <div className="p-4 space-y-4 flex-1 text-sm">
                                            <InputGroup label="形式"><select value={equipParams.filterType} onChange={(e)=>setEquipParams({...equipParams, filterType: e.target.value})} className="w-full bg-transparent border-b border-slate-300 outline-none pb-1"><option value="bag">袋濾式 (Bag Filter)</option><option value="cartridge">濾心式 (Cartridge)</option></select></InputGroup>
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label="精度 (um)"><input type="number" value={equipParams.filterMicron} onChange={(e)=>setEquipParams({...equipParams, filterMicron: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                                <InputGroup label="初始壓損" unit="kPa"><input type="number" value={equipParams.dpFilter} onChange={(e)=>setEquipParams({...equipParams, dpFilter: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                            </div>
                                            <div className="bg-amber-50 -mx-4 -mb-4 p-4 border-t border-amber-100 mt-auto">
                                                <div className="text-center">
                                                    <div className="text-xs text-amber-800/70 mb-1">建議規格型號</div>
                                                    <div className="font-bold text-amber-800 text-base">{equipKPI.filterConfig}</div>
                                                    <div className="text-[10px] text-amber-600 font-mono mt-1">{equipKPI.filterModel} (DN{equipKPI.filterDN})</div>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>

                                    {/* PHE Card */}
                                    <Card ref={cardRefs.phe} highlighted={highlightedCard === 'phe'} className="flex flex-col border-t-4 border-t-blue-500">
                                        <SectionHeader icon="Activity" title="板熱 (PHE)" colorClass="bg-blue-50/50 border-blue-100 text-blue-900" subtitle={`Duty: ${equipKPI.pheDutyKW.toFixed(0)} kW`}/>
                                        <div className="p-4 space-y-4 flex-1 text-sm">
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label="二次溫差" unit="°C"><input type="number" step="0.5" value={equipParams.pheSecDeltaT} onChange={(e)=>setEquipParams({...equipParams, pheSecDeltaT: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                                <InputGroup label="趨近溫度" unit="°C"><input type="number" step="0.5" value={equipParams.pheApproach} onChange={(e)=>setEquipParams({...equipParams, pheApproach: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label="板片材質"><select value={equipParams.pheMaterial} onChange={(e)=>setEquipParams({...equipParams, pheMaterial: e.target.value})} className="w-full bg-transparent border-b border-slate-300 outline-none pb-1"><option value="SS304">SS304</option><option value="SS316">SS316</option><option value="Ti">Ti</option></select></InputGroup>
                                                <InputGroup label="設計壓力" unit="Bar"><select value={equipParams.phePressure} onChange={(e)=>setEquipParams({...equipParams, phePressure: e.target.value})} className="w-full bg-transparent border-b border-slate-300 outline-none pb-1"><option value="10">10</option><option value="16">16</option></select></InputGroup>
                                            </div>
                                            <div className="bg-blue-50 -mx-4 -mb-4 p-4 border-t border-blue-100">
                                                <div className="flex justify-between mb-1"><span className="text-xs text-blue-800 font-semibold">建議管徑 (Pri)</span><span className={`font-mono font-bold ${equipKPI.pheNozzle.vel > 2.5 ? 'text-red-500':'text-blue-900'}`}>DN{equipKPI.pheNozzle.dn} <span className="text-[10px] font-normal">({equipKPI.pheNozzle.vel.toFixed(1)}m/s)</span></span></div>
                                                <div className="text-[10px] text-amber-600 mt-2 bg-amber-50 px-2 py-1 rounded border border-amber-200"><Icon name="AlertTriangle" size={10} className="inline mr-1"/> 需廠商熱力計算</div>
                                            </div>
                                        </div>
                                    </Card>

                                    {/* Tank Card */}
                                    <Card ref={cardRefs.tank} highlighted={highlightedCard === 'tank'} className={`flex flex-col border-t-4 ${equipParams.systemType === 'closed' ? 'border-t-indigo-500' : 'border-t-sky-500'}`}>
                                        <SectionHeader icon="Box" title={equipKPI.tankDesc} colorClass={`${equipParams.systemType === 'closed' ? 'bg-indigo-50/50 border-indigo-100 text-indigo-900' : 'bg-sky-50/50 border-sky-100 text-sky-900'}`}/>
                                        <div className="p-4 space-y-4 flex-1 text-sm">
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label="材質"><select value={equipParams.tankMaterial} onChange={(e)=>setEquipParams({...equipParams, tankMaterial: e.target.value})} className="w-full bg-transparent border-b border-slate-300 outline-none pb-1"><option value="SS304">SS304</option><option value="SS316">SS316</option><option value="PE">PE</option></select></InputGroup>
                                                <InputGroup label="安裝形式"><select value={equipParams.tankOrient} onChange={(e)=>setEquipParams({...equipParams, tankOrient: e.target.value})} className="w-full bg-transparent border-b border-slate-300 outline-none pb-1"><option value="vertical">Vertical</option><option value="horizontal">Horizontal</option></select></InputGroup>
                                            </div>
                                            {equipParams.systemType === 'closed' ? (
                                                <InputGroup label="系統總水量 (m³)"><input type="number" step="0.1" value={equipKPI.estSystemWaterVol.toFixed(1)} onChange={(e)=>setEquipParams({...equipParams, estSystemVol: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                            ) : (
                                                <InputGroup label="滯留時間 (min)"><input type="number" value={equipParams.tankHoldupTime} onChange={(e)=>setEquipParams({...equipParams, tankHoldupTime: parseFloat(e.target.value)||0})} className="w-full border-b border-slate-300 outline-none pb-1 font-mono"/></InputGroup>
                                            )}
                                            <div className="bg-slate-50 -mx-4 -mb-4 p-4 border-t border-slate-100 mt-auto">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-xs text-slate-600 font-bold">需求體積</span>
                                                    <span className="font-mono font-bold text-lg text-slate-800">{equipKPI.reqTankVol.toFixed(2)} m³</span>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Pro RFQ Modal */}
                    <Modal isOpen={showRFQModal} onClose={() => setShowRFQModal(false)} title="詢價單預覽 (RFQ Preview)" wide>
                        <div className="bg-white text-slate-800 font-serif p-8 max-w-3xl mx-auto shadow-sm border border-slate-200 rfq-paper">
                            {/* Paper Header */}
                            <div className="border-b-2 border-slate-800 pb-4 mb-6 flex justify-between items-end">
                                <div>
                                    <h1 className="text-2xl font-bold text-slate-900 tracking-tight">PCW SYSTEM SPECIFICATION</h1>
                                    <p className="text-sm text-slate-500 font-sans mt-1">Request for Quotation</p>
                                </div>
                                <div className="text-right text-xs text-slate-500 font-mono">
                                    <p>Date: {new Date().toISOString().split('T')[0]}</p>
                                    <p>Ref: PCW-EST-V6.3</p>
                                </div>
                            </div>

                            {/* Section: General */}
                            <div className="mb-6">
                                <h3 className="text-sm font-bold bg-slate-100 p-1 px-2 border-l-4 border-slate-500 uppercase tracking-wide mb-3">1. General Design Data</h3>
                                <div className="grid grid-cols-3 gap-4 text-xs">
                                    <div className="p-2 border border-slate-100"><span className="text-slate-400 block mb-1">Fluid</span><span className="font-semibold">{fluidProp.name}</span></div>
                                    <div className="p-2 border border-slate-100"><span className="text-slate-400 block mb-1">Water Quality</span><span className="font-semibold">{equipParams.specQuality}</span></div>
                                    <div className="p-2 border border-slate-100"><span className="text-slate-400 block mb-1">System Type</span><span className="font-semibold">{equipParams.systemType.toUpperCase()}</span></div>
                                </div>
                            </div>

                            {/* Section: Equipment Table */}
                            <div className="mb-8">
                                <h3 className="text-sm font-bold bg-slate-100 p-1 px-2 border-l-4 border-slate-500 uppercase tracking-wide mb-3">2. Equipment Specifications</h3>
                                <table className="w-full text-xs border-collapse border border-slate-200">
                                    <thead>
                                        <tr className="bg-slate-50 text-left">
                                            <th className="border p-2 w-1/4">Item</th>
                                            <th className="border p-2 w-1/2">Description / Value</th>
                                            <th className="border p-2 w-1/4">Note</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {/* PHE */}
                                        <tr>
                                            <td className="border p-2 font-bold" rowSpan="3">Plate Heat Exchanger</td>
                                            <td className="border p-2">Capacity: <b>{equipKPI.pheDutyKW.toFixed(0)} kW</b></td>
                                            <td className="border p-2 text-slate-500">Dual Source</td>
                                        </tr>
                                        <tr>
                                            <td className="border p-2">Primary Flow: {systemKPI.effectiveFlowM3h.toFixed(1)} m³/h</td>
                                            <td className="border p-2 text-slate-500">Approach: {equipParams.pheApproach}°C</td>
                                        </tr>
                                        <tr>
                                            <td className="border p-2">Material: {equipParams.pheMaterial} (Pressure: {equipParams.phePressure} bar)</td>
                                            <td className="border p-2"></td>
                                        </tr>
                                        
                                        {/* Pump */}
                                        <tr>
                                            <td className="border p-2 font-bold" rowSpan="3">Circulation Pump</td>
                                            <td className="border p-2">Flow: <b>{systemKPI.recPumpFlowM3h.toFixed(1)} m³/h</b> @ Head: <b>{equipKPI.pumpHeadM.toFixed(1)} m</b></td>
                                            <td className="border p-2 text-slate-500">{equipParams.pumpType}</td>
                                        </tr>
                                        <tr>
                                            <td className="border p-2">Motor: {equipParams.pumpPowerSource}, Eff: {equipParams.motorEff}</td>
                                            <td className="border p-2 text-slate-500">{equipParams.pumpRPM} RPM</td>
                                        </tr>
                                        <tr>
                                            <td className="border p-2">Est. Power: {equipKPI.pumpEstShaftKW.toFixed(2)} kW</td>
                                            <td className="border p-2 text-slate-500">NPSHa: {equipParams.systemType==='open'?equipKPI.npshA.toFixed(1):'N/A'}</td>
                                        </tr>

                                        {/* Filter */}
                                        <tr>
                                            <td className="border p-2 font-bold">Liquid Filter</td>
                                            <td className="border p-2">{equipParams.filterType} Type, {equipParams.filterMicron} micron, Model: {equipKPI.filterModel}</td>
                                            <td className="border p-2"></td>
                                        </tr>

                                        {/* Tank */}
                                        <tr>
                                            <td className="border p-2 font-bold">Tank</td>
                                            <td className="border p-2">Volume: <b>{equipKPI.reqTankVol.toFixed(2)} m³</b> ({equipKPI.tankDesc})</td>
                                            <td className="border p-2">{equipParams.tankMaterial}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            {/* Footer Signoff */}
                            <div className="mt-12 pt-8 border-t border-slate-200 grid grid-cols-2 gap-12">
                                <div>
                                    <div className="h-10 border-b border-slate-400 mb-2"></div>
                                    <p className="text-xs text-slate-500 uppercase">Prepared By</p>
                                </div>
                                <div>
                                    <div className="h-10 border-b border-slate-400 mb-2"></div>
                                    <p className="text-xs text-slate-500 uppercase">Approved By</p>
                                </div>
                            </div>
                        </div>

                        {/* Actions */}
                        <div className="flex justify-end gap-3 p-4 bg-slate-50 border-t border-slate-200">
                            <button onClick={() => setShowRFQModal(false)} className="px-4 py-2 text-slate-500 hover:bg-slate-200 rounded text-sm">Close</button>
                            <button onClick={() => handleProtectedAction(handleExportExcel)} className="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded shadow-sm text-sm font-bold flex items-center gap-2">
                                <Icon name="Table" size={16}/> Export Excel
                                {isLocked && <Icon name="Lock" size={12} className="opacity-70"/>}
                            </button>
                            <button onClick={() => window.print()} className="px-6 py-2 bg-slate-800 hover:bg-slate-900 text-white rounded shadow-sm text-sm font-bold flex items-center gap-2">
                                <Icon name="Printer" size={16}/> Print PDF
                            </button>
                        </div>
                    </Modal>

                    {/* Unlock Modal */}
                    <Modal isOpen={showUnlockModal} onClose={() => { setShowUnlockModal(false); setUnlockError(false); setPasswordInput(""); setPendingAction(null); }} title="解除功能鎖定">
                        <div className="space-y-4">
                            <div className="bg-amber-50 p-3 rounded text-xs text-amber-800 border border-amber-200">
                                <p className="font-bold mb-1">為什麼需要密碼？</p>
                                <p>這是一個前端應用程式，密碼主要作為 UI 防呆機制，防止在簡報或列印過程中誤觸關鍵數據，或避免非工程人員隨意匯出內部規格。</p>
                            </div>
                            <p className="text-sm text-slate-600 font-bold">請輸入密碼 </p>
                            <input type="password" value={passwordInput} onChange={(e) => { setPasswordInput(e.target.value); setUnlockError(false); }} onKeyDown={(e) => e.key === 'Enter' && attemptUnlock()} className="w-full border p-2 rounded outline-none font-mono focus:border-blue-500" placeholder="Password" autoFocus/>
                            {unlockError && <p className="text-xs text-red-500 font-bold">密碼錯誤</p>}
                            <div className="flex justify-end gap-2"><button onClick={() => { setShowUnlockModal(false); setPendingAction(null); }} className="px-4 py-2 text-slate-500 text-sm">取消</button><button onClick={attemptUnlock} className="px-4 py-2 bg-blue-600 text-white text-sm rounded">確認</button></div>
                        </div>
                    </Modal>

                    {/* Help Modal */}
                    <Modal isOpen={showHelpModal} onClose={() => setShowHelpModal(false)} title="PCW 系統估算工具 - 操作手冊" wide>
                        <div className="flex flex-col h-[500px]">
                            <div className="flex border-b border-slate-200 mb-4 gap-4">
                                <button onClick={() => setHelpTab('quick')} className={`pb-2 text-sm font-bold border-b-2 transition ${helpTab === 'quick' ? 'border-blue-500 text-blue-600' : 'border-transparent text-slate-400 hover:text-slate-600'}`}>快速上手 (Workflow)</button>
                                <button onClick={() => setHelpTab('npsh')} className={`pb-2 text-sm font-bold border-b-2 transition ${helpTab === 'npsh' ? 'border-amber-500 text-amber-600' : 'border-transparent text-slate-400 hover:text-slate-600'}`}>NPSH 計算</button>
                            </div>
                            
                            <div className="overflow-y-auto flex-1 pr-2">
                                {helpTab === 'quick' && (
                                    <div className="space-y-6 text-sm text-slate-600">
                                        <section>
                                            <h4 className="font-bold text-slate-800 mb-2">v6.3 新功能介紹</h4>
                                            <ul className="list-disc pl-8 space-y-1">
                                                <li><strong>互動式 P&ID：</strong> 點擊圖面元件，可直接跳轉至設定卡片。</li>
                                                <li><strong>負載條：</strong> 視覺化呈現系統負載率。</li>
                                                <li><strong>專業 RFQ：</strong> 提供擬真規格書預覽與列印。</li>
                                            </ul>
                                        </section>
                                    </div>
                                )}
                                {helpTab === 'npsh' && (
                                    <div className="space-y-4 text-sm">
                                        <div className="bg-slate-100 p-4 rounded font-mono text-xs">
                                            NPSHa = Patm + Hz - Hf - Pvp
                                        </div>
                                        <p>
                                            當選擇「開放式系統」時，泵浦卡片會出現 NPSH 輸入欄位。
                                            請輸入 <strong>靜壓頭 (Hz)</strong> (水箱液面高於泵浦吸入口的高度) 與 <strong>吸入損失 (Hf)</strong>。
                                            系統會自動扣除該溫度下的飽和蒸氣壓 (Pvp)，若 NPSHa 小於 3m 會發出警告。
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </Modal>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PCWEstimator />);
    </script>
</body>
</html>
