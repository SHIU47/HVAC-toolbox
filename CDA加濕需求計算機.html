<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDA 加濕工程計算系統 v2.7</title>
    
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 載入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 載入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 自定義 Tailwind 配置 (模擬原本的 slate-50 等顏色) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* 額外的動畫樣式 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-in {
            animation: fadeIn 0.3s ease-out;
        }
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- 內建圖示組件 (取代 Lucide React) ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Activity = (props) => <IconBase {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconBase>;
        const Download = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></IconBase>;
        const Settings2 = (props) => <IconBase {...props}><line x1="21" x2="14" y1="4" y2="4"/><line x1="10" x2="3" y1="4" y2="4"/><line x1="21" x2="12" y1="12" y2="12"/><line x1="8" x2="3" y1="12" y2="12"/><line x1="21" x2="16" y1="20" y2="20"/><line x1="12" x2="3" y1="20" y2="20"/><line x1="14" x2="14" y1="2" y2="6"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="16" x2="16" y1="18" y2="22"/></IconBase>;
        const ThermometerSun = (props) => <IconBase {...props}><path d="M12 9a4 4 0 0 0-2 7.5"/><path d="M12 3v2"/><path d="M6.6 18.4l-1.4 1.4"/><path d="M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/><path d="M4 13H2"/><path d="M6.34 7.34L4.93 5.93"/></IconBase>;
        const Droplets = (props) => <IconBase {...props}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>;
        const Gauge = (props) => <IconBase {...props}><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></IconBase>;
        const ShieldCheck = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/></IconBase>;
        const Wind = (props) => <IconBase {...props}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></IconBase>;
        const LayoutGrid = (props) => <IconBase {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></IconBase>;
        const Waves = (props) => <IconBase {...props}><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Lock = (props) => <IconBase {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;


        const App = () => {
            // 狀態管理
            const [zones, setZones] = useState([
                { id: 1, name: "區域 1 (範例)", flow: 61000, type: 'main' },
            ]);
            const [temp, setTemp] = useState(22.5);
            const [rh, setRh] = useState(43);
            const [efficiency, setEfficiency] = useState(85);
            const [safetyFactor, setSafetyFactor] = useState(1.0);
            
            // 密碼模態框狀態
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [passwordError, setPasswordError] = useState('');
            
            // 物理常數與計算函式
            const calculateDewPoint = (T, RH) => {
                const a = 17.27;
                const b = 237.7;
                const alpha = ((a * T) / (b + T)) + Math.log(RH / 100);
                return ((b * alpha) / (a - alpha)).toFixed(1);
            };

            const humidityRatio = useMemo(() => {
                const Ps = 6.112 * Math.exp((17.62 * temp) / (243.12 + temp)) * 100; 
                const Pv = Ps * (rh / 100);
                const Patm = 101325; 
                return (0.622 * Pv) / (Patm - Pv); 
            }, [temp, rh]);

            const calculateData = (flow) => {
                const W = humidityRatio;
                const rhoStandard = 1.293;
                const massFlow = flow * rhoStandard;
                const theoreticalWater = massFlow * W;
                const designWater = (theoreticalWater / (efficiency / 100)) * safetyFactor;
                const hydrationRate = flow > 0 ? (designWater * 1000 / flow).toFixed(2) : 0;

                return {
                wGrams: (W * 1000).toFixed(2),
                theoretical: theoreticalWater.toFixed(1),
                design: designWater.toFixed(1),
                hydrationRate,
                };
            };

            const dewPoint = useMemo(() => calculateDewPoint(temp, rh), [temp, rh]);
            const absHumidityDisplay = humidityRatio.toFixed(5);

            const zoneResults = useMemo(() => {
                return zones.map(z => ({ ...z, result: calculateData(z.flow) }));
            }, [zones, temp, rh, efficiency, humidityRatio, safetyFactor]);

            const totals = useMemo(() => {
                return {
                flow: zones.reduce((acc, z) => acc + (z.flow || 0), 0),
                water: zoneResults.reduce((acc, z) => acc + parseFloat(z.result.design), 0),
                };
            }, [zoneResults]);

            const addZone = () => {
                const newId = zones.length > 0 ? Math.max(...zones.map(z => z.id)) + 1 : 1;
                setZones([...zones, { id: newId, name: `新區域 ${newId}`, flow: 0, type: 'branch' }]);
            };

            const updateZone = (id, field, value) => {
                setZones(zones.map(z => z.id === id ? { ...z, [field]: value } : z));
            };

            const removeZone = (id) => {
                setZones(zones.filter(z => z.id !== id));
            };

            // 處理匯出點擊
            const handleExportClick = () => {
                setPasswordInput('');
                setPasswordError('');
                setShowPasswordModal(true);
            };

            // 驗證密碼並匯出
            const verifyAndExport = (e) => {
                e.preventDefault(); 
                if (passwordInput === '900407') {
                const headers = ["區域名稱", "類型", "風量(NCMH)", "安全係數", "絕對濕度(kg/kg)", "理論需水(kg/hr)", "設計噴霧(kg/hr)", "補水率(g/Nm3)"];
                const rows = zoneResults.map(z => [
                    z.name, 
                    z.type === 'main' ? '主幹系統' : '分支系統', 
                    z.flow, 
                    safetyFactor, 
                    absHumidityDisplay,
                    z.result.theoretical, 
                    z.result.design, 
                    z.result.hydrationRate
                ]);
                const csvContent = "data:text/csv;charset=utf-8," + [headers, ...rows].map(e => e.join(",")).join("\n");
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `CDA_Humidification_Report_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setShowPasswordModal(false);
                } else {
                setPasswordError('密碼錯誤，權限不足');
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-600 selection:bg-indigo-100 selection:text-indigo-700 relative">
                
                {/* Password Modal */}
                {showPasswordModal && (
                    <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 animate-in">
                    <div className="bg-white rounded-[2rem] shadow-2xl w-full max-w-sm overflow-hidden border border-white/50">
                        <div className="bg-gradient-to-r from-slate-50 to-white p-6 border-b border-slate-100 flex justify-between items-center">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-br from-amber-400 to-orange-500 p-2 rounded-xl text-white shadow-lg shadow-orange-500/20">
                            <ShieldCheck size={20} />
                            </div>
                            <h3 className="font-bold text-slate-800">安全驗證</h3>
                        </div>
                        <button 
                            onClick={() => setShowPasswordModal(false)}
                            className="text-slate-400 hover:text-slate-600 p-2 hover:bg-slate-100 rounded-full transition-colors"
                        >
                            <X size={20} />
                        </button>
                        </div>
                        
                        <div className="p-8">
                        <p className="text-sm text-slate-500 mb-6 font-medium leading-relaxed">此為敏感工程數據，請輸入工程師密碼 (Passcode) 以解鎖匯出功能。</p>
                        <form onSubmit={verifyAndExport} className="space-y-5">
                            <div className="relative group">
                            <Lock className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors" size={18} />
                            <input 
                                type="password"
                                autoFocus
                                placeholder="輸入密碼..."
                                className={`w-full bg-slate-50 border rounded-2xl py-3.5 pl-12 pr-4 text-slate-800 font-bold outline-none focus:ring-4 transition-all ${passwordError ? 'border-rose-300 focus:border-rose-500 focus:ring-rose-500/10' : 'border-slate-200 focus:border-blue-500 focus:ring-blue-500/10'}`}
                                value={passwordInput}
                                onChange={(e) => setPasswordInput(e.target.value)}
                            />
                            </div>
                            
                            {passwordError && (
                            <div className="flex items-center gap-2 text-xs font-bold text-rose-500 animate-pulse bg-rose-50 p-3 rounded-xl border border-rose-100">
                                <AlertTriangle size={14} /> {passwordError}
                            </div>
                            )}
                            
                            <div className="flex gap-3 pt-2">
                            <button 
                                type="button"
                                onClick={() => setShowPasswordModal(false)}
                                className="flex-1 py-3 rounded-xl text-slate-500 font-bold hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all text-sm"
                            >
                                取消
                            </button>
                            <button 
                                type="submit"
                                className="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-600/20 transition-all text-sm active:scale-95 flex items-center justify-center gap-2"
                            >
                                確認匯出 <ChevronRight size={14} />
                            </button>
                            </div>
                        </form>
                        </div>
                    </div>
                    </div>
                )}

                {/* Top Sticky Bar - Dark Mode */}
                <div className="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-xl border-b border-slate-800/60 px-6 py-4 shadow-2xl shadow-black/20">
                    <div className="max-w-7xl mx-auto flex justify-between items-center">
                    <div className="flex items-center gap-4">
                        <div className="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-2.5 rounded-xl shadow-lg shadow-purple-500/20 text-white animate-in zoom-in duration-300">
                        <Activity size={24} />
                        </div>
                        <div>
                        <h1 className="text-xl font-black text-white tracking-tight">CDA 加濕工程計算系統</h1>
                        <div className="flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-slate-400">
                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">v2.7 Enterprise</span>
                            <span>•</span>
                            <span>Psychrometric Analysis</span>
                        </div>
                        </div>
                    </div>
                    
                    <div className="flex gap-3">
                        <button 
                        onClick={handleExportClick}
                        className="flex items-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-200 px-5 py-2.5 rounded-xl border border-slate-700 shadow-sm transition-all text-sm font-bold hover:shadow-md active:scale-95 group"
                        >
                        <Download size={16} className="text-slate-400 group-hover:text-slate-200 transition-colors" /> <span className="hidden sm:inline">匯出報表</span>
                        </button>
                        <button 
                        onClick={addZone}
                        className="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-xl shadow-lg shadow-blue-900/20 transition-all text-sm font-bold hover:shadow-xl active:scale-95"
                        >
                        <Plus size={16} /> <span className="hidden sm:inline">新增區域</span>
                        </button>
                    </div>
                    </div>
                </div>

                <div className="max-w-7xl mx-auto p-4 md:p-8">
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Sidebar: Controls */}
                    <aside className="lg:col-span-3 space-y-6">
                        <div className="bg-white rounded-[2rem] border border-slate-100 shadow-xl shadow-slate-200/40 p-6 sticky top-28">
                        <div className="flex items-center gap-2 mb-6 pb-4 border-b border-slate-50">
                            <Settings2 size={18} className="text-indigo-500" />
                            <h2 className="font-bold text-slate-800 text-sm uppercase tracking-wider">環境參數配置</h2>
                        </div>
                        
                        {/* Status Card - Colorful */}
                        <div className="bg-gradient-to-br from-indigo-50 via-white to-purple-50 rounded-2xl p-5 border border-indigo-100 mb-8 relative overflow-hidden group">
                            <div className="relative z-10 space-y-4">
                            <div>
                                <p className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1">絕對濕度 Abs. Humidity</p>
                                <p className="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 tabular-nums">{absHumidityDisplay}</p>
                                <p className="text-xs font-medium text-indigo-400">kg/kg (DA)</p>
                            </div>
                            <div className="w-full h-px bg-indigo-200/30"></div>
                            <div className="flex justify-between items-center">
                                <span className="text-xs font-bold text-slate-500">等效露點</span>
                                <span className="text-sm font-black text-slate-700">{dewPoint}°C</span>
                            </div>
                            </div>
                            {/* Decorative blob */}
                            <div className="absolute -right-6 -top-6 w-28 h-28 bg-purple-200/20 rounded-full blur-2xl group-hover:bg-purple-200/30 transition-colors duration-500"></div>
                            <div className="absolute -left-6 -bottom-6 w-28 h-28 bg-indigo-200/20 rounded-full blur-2xl group-hover:bg-indigo-200/30 transition-colors duration-500"></div>
                        </div>

                        <div className="space-y-8">
                            {/* Temp Slider - Warm Colors */}
                            <div className="group">
                            <div className="flex justify-between text-xs font-medium text-slate-500 mb-2 items-center">
                                <span className="flex items-center gap-1"><ThermometerSun size={12} className="text-amber-500" /> 目標溫度</span>
                                <span className="text-amber-600 font-bold bg-amber-50 px-2 py-0.5 rounded text-[10px] border border-amber-100">{temp}°C</span>
                            </div>
                            <input type="range" min="15" max="30" step="0.1" value={temp} onChange={(e)=>setTemp(parseFloat(e.target.value))} 
                                className="w-full h-2 bg-slate-100 rounded-full appearance-none cursor-pointer accent-amber-500 hover:accent-amber-400 transition-all" />
                            </div>

                            {/* RH Slider - Cool Colors */}
                            <div className="group">
                            <div className="flex justify-between text-xs font-medium text-slate-500 mb-2 items-center">
                                <span className="flex items-center gap-1"><Droplets size={12} className="text-cyan-500" /> 相對濕度</span>
                                <span className={`font-bold px-2 py-0.5 rounded text-[10px] border transition-colors ${rh > 65 ? 'bg-rose-50 text-rose-600 border-rose-100' : 'bg-cyan-50 text-cyan-600 border-cyan-100'}`}>{rh}%</span>
                            </div>
                            <input type="range" min="30" max="80" step="1" value={rh} onChange={(e)=>setRh(parseFloat(e.target.value))} 
                                className={`w-full h-2 rounded-full appearance-none cursor-pointer transition-all ${rh > 65 ? 'bg-rose-100 accent-rose-500' : 'bg-slate-100 accent-cyan-500 hover:accent-cyan-400'}`} />
                            {rh > 65 && <p className="text-[10px] text-rose-500 mt-2 flex items-center gap-1 font-bold animate-pulse"><AlertTriangle size={10} /> 高冷凝風險</p>}
                            </div>

                            {/* Input Fields - Tech Colors */}
                            <div className="grid grid-cols-2 gap-3 pt-2">
                            <div className="space-y-1.5">
                                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-1"><Gauge size={10} /> 效率 %</label>
                                <input 
                                type="number" value={efficiency} onChange={(e)=>setEfficiency(parseFloat(e.target.value))}
                                className="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm font-bold text-emerald-600 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all text-center"
                                />
                            </div>
                            <div className="space-y-1.5">
                                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-1"><ShieldCheck size={10} /> 安全係數</label>
                                <input 
                                type="number" step="0.05" value={safetyFactor} onChange={(e)=>setSafetyFactor(parseFloat(e.target.value))}
                                className="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm font-bold text-violet-600 focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500 outline-none transition-all text-center"
                                />
                            </div>
                            </div>
                            
                            <div className="bg-slate-50 rounded-xl p-4 text-[10px] text-slate-400 leading-relaxed border border-slate-100 flex gap-2 items-start">
                            <Info size={14} className="shrink-0 mt-0.5 text-slate-400" />
                            <span>基準定義：0°C, 101.325kPa, ρ=1.293 kg/m³。安全係數 1.0 為純理論值。</span>
                            </div>
                        </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="lg:col-span-9 space-y-6">
                        
                        {/* KPI Cards - Vibrant Accents */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="bg-white rounded-[2rem] p-6 border border-slate-100 shadow-xl shadow-blue-900/5 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300">
                            <div className="absolute right-0 top-0 w-40 h-40 bg-gradient-to-br from-cyan-50 to-blue-50 rounded-full -mr-12 -mt-12 opacity-50 transition-colors"></div>
                            <div className="relative">
                            <div className="flex items-center gap-3 mb-3">
                                <div className="p-2.5 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-xl text-white shadow-lg shadow-blue-500/20"><Droplets size={20} /></div>
                                <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">全場總設計水量</span>
                            </div>
                            <div className="flex items-baseline gap-2">
                                <span className="text-5xl font-black text-slate-800 tracking-tighter tabular-nums">{totals.water.toLocaleString(undefined, {maximumFractionDigits: 1})}</span>
                                <span className="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600">kg/hr</span>
                            </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-[2rem] p-6 border border-slate-100 shadow-xl shadow-slate-200/40 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300">
                            <div className="absolute right-0 top-0 w-40 h-40 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-full -mr-12 -mt-12 opacity-50"></div>
                            <div className="relative">
                            <div className="flex items-center gap-3 mb-3">
                                <div className="p-2.5 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-xl text-white shadow-lg shadow-emerald-500/20"><Wind size={20} /></div>
                                <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">總 CDA 處理風量</span>
                            </div>
                            <div className="flex items-baseline gap-2">
                                <span className="text-5xl font-black text-slate-800 tracking-tighter tabular-nums">{totals.flow.toLocaleString()}</span>
                                <span className="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-500 to-teal-600">NCMH</span>
                            </div>
                            </div>
                        </div>
                        </div>

                        {/* Zone List */}
                        <div className="space-y-4">
                        <div className="flex items-center justify-between px-2">
                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                            <LayoutGrid size={16} /> 區域列表
                            </h3>
                            <span className="text-[10px] font-bold text-indigo-500 bg-indigo-50 px-3 py-1 rounded-full border border-indigo-100">
                            {zones.length} Active Zones
                            </span>
                        </div>

                        {zoneResults.map((zone) => (
                            <div key={zone.id} className="bg-white rounded-[2rem] border border-slate-100 shadow-lg shadow-slate-200/20 p-8 transition-all hover:shadow-xl hover:shadow-slate-200/30 group relative overflow-hidden">
                            
                            {/* Subtle Colored Stripe on Left */}
                            <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${zone.type === 'main' ? 'bg-indigo-500' : 'bg-emerald-500'}`}></div>

                            <div className="flex flex-col md:flex-row gap-10 items-start md:items-center pl-4">
                                
                                {/* Input Section */}
                                <div className="flex-1 space-y-5 w-full">
                                <div className="flex items-center gap-5">
                                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 shadow-sm ${zone.type === 'main' ? 'bg-indigo-50 text-indigo-600' : 'bg-emerald-50 text-emerald-600'}`}>
                                        {zone.type === 'main' ? <LayoutGrid size={24} /> : <Waves size={24} />}
                                    </div>
                                    <div className="flex-1">
                                        <input 
                                        value={zone.name}
                                        onChange={(e) => updateZone(zone.id, 'name', e.target.value)}
                                        className="block w-full text-xl font-black text-slate-800 placeholder-slate-300 border-none p-0 focus:ring-0 bg-transparent transition-colors hover:text-blue-600 focus:text-blue-600 mb-1"
                                        placeholder="輸入區域名稱..."
                                        />
                                        <div className="flex items-center gap-2">
                                        <select 
                                            value={zone.type}
                                            onChange={(e) => updateZone(zone.id, 'type', e.target.value)}
                                            className={`text-[10px] font-bold uppercase tracking-wider bg-transparent border-none p-0 focus:ring-0 cursor-pointer ${zone.type === 'main' ? 'text-indigo-500' : 'text-emerald-500'}`}
                                        >
                                            <option value="main">Main System (主幹)</option>
                                            <option value="branch">Branch Line (支管)</option>
                                        </select>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex items-center gap-3 bg-slate-50 p-4 rounded-2xl border border-slate-100 group-focus-within:border-blue-200 group-focus-within:bg-blue-50/20 transition-colors">
                                    <span className="text-xs font-bold text-slate-400 uppercase px-1">Flow</span>
                                    <div className="w-px h-4 bg-slate-200"></div>
                                    <input 
                                        type="number"
                                        value={zone.flow}
                                        onChange={(e) => updateZone(zone.id, 'flow', parseFloat(e.target.value) || 0)}
                                        className="bg-transparent border-none p-0 focus:ring-0 text-2xl font-black text-slate-700 w-full"
                                    />
                                    <span className="text-xs font-bold text-slate-400">NCMH</span>
                                </div>
                                </div>

                                {/* Arrow Divider (Desktop) */}
                                <div className="hidden md:flex text-slate-200">
                                <ChevronRight size={28} strokeWidth={1.5} />
                                </div>

                                {/* Result Grid - Colorful Metrics */}
                                <div className="grid grid-cols-3 gap-4 md:gap-8 w-full md:w-auto min-w-[380px]">
                                <div className="space-y-1">
                                    <p className="text-[10px] font-bold text-emerald-500 uppercase tracking-widest">補水率</p>
                                    <p className="text-2xl font-bold text-slate-600 tabular-nums">{zone.result.hydrationRate} <span className="text-[10px] text-slate-400">g</span></p>
                                </div>
                                <div className="space-y-1">
                                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">理論值</p>
                                    <p className="text-2xl font-bold text-slate-600 tabular-nums">{zone.result.theoretical} <span className="text-[10px] text-slate-400">kg</span></p>
                                </div>
                                <div className="space-y-1 relative">
                                    <p className="text-[10px] font-bold text-indigo-500 uppercase tracking-widest">設計建議</p>
                                    <p className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 tabular-nums">{zone.result.design} <span className="text-xs font-bold text-slate-400">kg</span></p>
                                </div>
                                </div>

                                {/* Delete Action */}
                                <button 
                                onClick={() => removeZone(zone.id)}
                                className="p-3 text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-xl transition-all self-start md:self-center"
                                >
                                <Trash2 size={20} />
                                </button>

                            </div>
                            </div>
                        ))}
                        </div>
                    </main>
                    </div>
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>